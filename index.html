<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form to Print</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: #f4f8fb;
      color: #333;
      line-height: 1.6;
    }

    .header {
      background-color: #0074c4;
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
    }

    .logo {
      width: 150px;
      margin: 10px auto;
      display: block;
    }

    .form-container {
      max-width: 700px;
      margin: 20px auto;
      padding: 20px 40px 20px 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .section-title {
      margin-top: 30px;
      font-size: 20px;
      font-weight: bold;
      color: #0074c4;
      border-bottom: 2px solid #0074c4;
      padding-bottom: 5px;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 20px;
      page-break-inside: avoid;
    }

    .form-group label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
      color: #0074c4;
      font-size: 16px;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .height-weight-group {
      display: flex;
      gap: 10px;
    }

    .height-weight-group input {
      flex: 1;
    }

    .buttons {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 20px;
    }

    .buttons button {
      flex: 1;
      padding: 15px;
      font-size: 18px;
      font-weight: bold;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .print-button {
      background-color: #28a745;
      color: white;
    }

    .copy-button {
      background-color: #0074c4;
      color: white;
    }

    .clear-button {
      background-color: #d9534f;
      color: white;
    }

    .suggestions {
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: white;
      list-style-type: none;
      padding: 0;
      margin: 0;
      max-height: 150px;
      overflow-y: auto;
      z-index: 10;
      position: absolute;
      width: calc(100% - 20px);
      display: none; /* Hide suggestions list initially */
    }

    .suggestions li {
      padding: 10px;
      cursor: pointer;
      border-bottom: 1px solid #ddd;
    }

    .suggestions li:last-child {
      border-bottom: none;
    }

    .suggestions li:hover {
      background-color: #f1f1f1;
    }

    .selected-medications {
      margin-top: 10px;
    }

    .selected-medications div {
      padding: 5px 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: #f9f9f9;
      margin-bottom: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .selected-medications div .delete-medication {
      margin-left: 10px;
      background: #d9534f;
      color: white;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
    }

    /* Print-Specific Styles */
    @media print {
      body, html {
        margin: 0;
        padding: 0;
        width: 8.5in;
        height: 11in;
      }

      .header {
        display: none;
      }

      .form-container {
        padding: 0.5in;
      }

      .buttons {
        display: none;
      }
    }
  </style>
</head>
<body>

<div class="header">
  <img src="https://janetfloreshealth.com/wp-content/uploads/2022/08/HMIA_logo-01-3.png" alt="HealthMarkets Logo" class="logo">
  HealthMarkets Client Information Form
</div>

<div class="form-container" id="formContainer">
  <!-- Applicant Section -->
  <div class="section-title">APPLICANT</div>
  <div class="form-group">
    <label for="firstName">First Name:</label>
    <input type="text" id="firstName" placeholder="Enter First Name">
  </div>
  <div class="form-group">
    <label for="lastName">Last Name:</label>
    <input type="text" id="lastName" placeholder="Enter Last Name">
  </div>
  <div class="form-group">
    <label for="address">Address:</label>
    <input type="text" id="address" placeholder="Enter Address">
  </div>
  <div class="form-group">
    <label for="email">Email:</label>
    <input type="email" id="email" placeholder="Enter Email">
  </div>
  <div class="form-group">
    <label for="phone">Phone:</label>
    <input type="text" id="phone" placeholder="Enter Phone">
  </div>
  <div class="form-group">
    <label for="dob">DOB:</label>
    <input type="date" id="dob">
  </div>
  <div class="form-group">
    <label for="income">Estimated Annual Household Income:</label>
    <input type="number" id="income" placeholder="Enter Income">
  </div>
  <div class="form-group">
    <label for="heightFeet">Height:</label>
    <div class="height-weight-group">
      <input type="number" id="heightFeet" placeholder="Feet" min="0" max="8">
      <input type="number" id="heightInches" placeholder="Inches" min="0" max="11">
    </div>
  </div>
  <div class="form-group">
    <label for="weight">Weight (lbs):</label>
    <input type="number" id="weight" placeholder="Enter Weight">
  </div>
  <div class="form-group">
    <label for="doctors">Doctors (How often? Importance?):</label>
    <textarea id="doctors" rows="3" placeholder="Enter doctor details"></textarea>
  </div>

  <!-- Medications Section -->
  <div class="form-group">
    <label for="medication-input">Medications:</label>
    <input type="text" id="medication-input" class="medication-input" placeholder="Enter medication">
    <ul class="suggestions" id="suggestions"></ul>
    <div class="selected-medications" id="selected-medications"></div>
  </div>

  <!-- Family Section -->
  <div class="section-title">FAMILY</div>
  <div class="form-group">
    <label for="familyCount">Number of Family Members:</label>
    <input type="number" id="familyCount" min="0" max="10" onchange="generateFamilyFields()">
  </div>
  <div id="familyFields"></div>
</div>

<div class="buttons">
  <button class="print-button" onclick="window.print()">Print Form</button>
  <button class="copy-button" onclick="copyForm()">Copy Form</button>
  <button class="clear-button" onclick="clearForm()">Clear Form</button>
</div>

<script>
  // Attach the medication event listener to the input fields
  function attachMedicationFunctionality(inputElement) {
    const suggestionsElement = inputElement.nextElementSibling;
    const selectedMedicationsElement = inputElement.parentElement.querySelector('.selected-medications');

    inputElement.addEventListener('input', function() {
      const query = inputElement.value.toLowerCase();
      suggestionsElement.innerHTML = ""; // Clear previous suggestions
      suggestionsElement.style.display = "none"; // Hide suggestions initially

      if (query.length > 1) { // Start searching after 1 character
        fetch(`https://api.fda.gov/drug/label.json?search=openfda.brand_name:${query}*&limit=10`)
          .then(response => response.json())
          .then(data => {
            if (data.results) {
              const uniqueSuggestions = new Set();
              data.results.forEach(item => {
                const brandName = item.openfda.brand_name ? item.openfda.brand_name[0] : '';
                let strengths = new Set();

                // Attempt to get strengths from `active_ingredient` if available
                if (item.openfda.active_ingredient) {
                  item.openfda.active_ingredient.forEach(ingredient => {
                    const strengthMatches = ingredient.match(/\d*\.?\d+\s*(mg|mcg|g|ml)/gi);
                    if (strengthMatches) {
                      strengthMatches.forEach(match => strengths.add(match));
                    }
                  });
                }

                // Fallback to `dosage_and_administration` if no strength found in `active_ingredient`
                if (item.dosage_and_administration) {
                  item.dosage_and_administration.forEach(dosage => {
                    const dosageMatches = dosage.match(/\d*\.?\d+\s*(mg|mcg|g|ml)/gi);
                    if (dosageMatches) {
                      dosageMatches.forEach(match => strengths.add(match));
                    }
                  });
                }

                // Create unique suggestions for each brand and strength combination
                strengths.forEach(strength => {
                  if (brandName && strength) {
                    const suggestionText = `${brandName} ${strength}`;
                    if (!uniqueSuggestions.has(suggestionText)) {
                      uniqueSuggestions.add(suggestionText);
                      const li = document.createElement('li');
                      li.textContent = suggestionText;
                      li.addEventListener('click', function() {
                        const medicationDiv = document.createElement('div');
                        medicationDiv.textContent = suggestionText;
                        const deleteButton = document.createElement('button');
                        deleteButton.textContent = "X";
                        deleteButton.className = "delete-medication";
                        deleteButton.onclick = () => medicationDiv.remove();
                        medicationDiv.appendChild(deleteButton);
                        selectedMedicationsElement.appendChild(medicationDiv);
                        suggestionsElement.innerHTML = ""; // Clear suggestions after selection
                        suggestionsElement.style.display = "none";
                        inputElement.value = ""; // Clear input after selection
                      });
                      suggestionsElement.appendChild(li);
                    }
                  }
                });
              });
              if (suggestionsElement.hasChildNodes()) {
                suggestionsElement.style.display = "block";
              }
            }
          })
          .catch(error => {
            console.error('Error fetching data from OpenFDA:', error);
          });
      }
    });
  }

  function generateFamilyFields() {
    const familyCount = document.getElementById("familyCount").value;
    const familyFields = document.getElementById("familyFields");
    const applicantLastName = document.getElementById("lastName").value;
    familyFields.innerHTML = ""; // Clear previous fields

    for (let i = 1; i <= familyCount; i++) {
      familyFields.innerHTML += `
        <div class="form-group family-member">
          <label>Family Member ${i} - First Name:</label>
          <input type="text" id="familyFirstName${i}" placeholder="Enter First Name">
        </div>
        <div class="form-group">
          <label>Last Name:</label>
          <input type="text" id="familyLastName${i}" placeholder="Enter Last Name" value="${applicantLastName}">
        </div>
        <div class="form-group">
          <label>Date of Birth:</label>
          <input type="date" id="familyDOB${i}">
        </div>
        <div class="form-group">
          <label>Relation:</label>
          <input type="text" id="familyRelation${i}" placeholder="Spouse, Child, etc.">
        </div>
        <div class="form-group">
          <label>Height:</label>
          <div class="height-weight-group">
            <input type="number" id="familyHeightFeet${i}" placeholder="Feet" min="0" max="8">
            <input type="number" id="familyHeightInches${i}" placeholder="Inches" min="0" max="11">
          </div>
        </div>
        <div class="form-group">
          <label>Weight (lbs):</label>
          <input type="number" id="familyWeight${i}" placeholder="Weight">
        </div>
        <div class="form-group">
          <label>Doctors:</label>
          <textarea id="familyDoctors${i}" rows="3" placeholder="Enter doctor details"></textarea>
        </div>
        <div class="form-group">
          <label>Medications:</label>
          <input type="text" id="familyMedications${i}" class="medication-input" placeholder="Enter medications">
          <ul class="suggestions" id="familySuggestions${i}" style="display: none;"></ul>
          <div class="selected-medications" id="familySelectedMedications${i}"></div>
        </div>`;
    }

    attachMedicationEventListeners();
  }

  function attachMedicationEventListeners() {
    document.querySelectorAll('.medication-input').forEach(input => {
      attachMedicationFunctionality(input);
    });
  }

  function clearForm() {
    document.querySelectorAll('input, textarea').forEach(input => input.value = '');
    document.querySelectorAll('.selected-medications').forEach(container => container.innerHTML = '');
  }

  function copyForm() {
    let copiedText = '';

    // Applicant Section
    copiedText += 'APPLICANT\n';
    copiedText += `First Name: ${document.getElementById('firstName').value}\n`;
    copiedText += `Last Name: ${document.getElementById('lastName').value}\n`;
    copiedText += `Address: ${document.getElementById('address').value}\n`;
    copiedText += `Email: ${document.getElementById('email').value}\n`;
    copiedText += `Phone: ${document.getElementById('phone').value}\n`;
    copiedText += `DOB: ${document.getElementById('dob').value}\n`;
    copiedText += `Estimated Annual Household Income: ${document.getElementById('income').value}\n`;
    copiedText += `Height: ${document.getElementById('heightFeet').value} ft ${document.getElementById('heightInches').value} in\n`;
    copiedText += `Weight: ${document.getElementById('weight').value} lbs\n`;
    copiedText += `Doctors: ${document.getElementById('doctors').value}\n`;
    copiedText += `Medications:\n`;
    document.querySelectorAll('#selected-medications div').forEach(div => {
      copiedText += `  - ${div.textContent.replace('X', '').trim()}\n`;
    });

    // Family Section
    copiedText += '\nFAMILY\n';
    const familyCount = document.getElementById('familyCount').value;
    for (let i = 1; i <= familyCount; i++) {
      copiedText += `\nFamily Member ${i}\n`;
      copiedText += `First Name: ${document.getElementById(`familyFirstName${i}`).value}\n`;
      copiedText += `Last Name: ${document.getElementById(`familyLastName${i}`).value}\n`;
      copiedText += `Date of Birth: ${document.getElementById(`familyDOB${i}`).value}\n`;
      copiedText += `Relation: ${document.getElementById(`familyRelation${i}`).value}\n`;
      copiedText += `Height: ${document.getElementById(`familyHeightFeet${i}`).value} ft ${document.getElementById(`familyHeightInches${i}`).value} in\n`;
      copiedText += `Weight: ${document.getElementById(`familyWeight${i}`).value} lbs\n`;
      copiedText += `Doctors: ${document.getElementById(`familyDoctors${i}`).value}\n`;
      copiedText += `Medications:\n`;
      document.querySelectorAll(`#familySelectedMedications${i} div`).forEach(div => {
        copiedText += `  - ${div.textContent.replace('X', '').trim()}\n`;
      });
    }

    // Copy to clipboard
    navigator.clipboard.writeText(copiedText).then(() => {
      alert('Form copied to clipboard!');
    }, () => {
      alert('Failed to copy form to clipboard.');
    });
  }

  // Attach the initial medication event listeners
  attachMedicationEventListeners();
</script>

</body>
</html>
